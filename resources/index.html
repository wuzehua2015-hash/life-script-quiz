<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>èµ„æºæ¨èåº“ - äººç”Ÿå‰§æœ¬æµ‹è¯•</title>
    <meta name="description" content="ä¸º12ç§äººç”Ÿå‰§æœ¬åŸå‹ç²¾é€‰çš„ä¹¦ç±ã€æ–‡ç« ã€è§†é¢‘ã€æ’­å®¢èµ„æºï¼ŒåŠ©åŠ›ä½ çš„æˆé•¿ä¹‹æ—…">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/resources.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="resources-page">
        <!-- è¿”å›æŒ‰é’® -->
        <a href="../index.html" class="back-btn">
            â† è¿”å›é¦–é¡µ
        </a>

        <!-- å¤´éƒ¨ -->
        <header class="resources-header">
            <h1>ğŸ“š èµ„æºæ¨èåº“</h1>
            <p>ä¸ºæ¯ä¸€ç§äººç”Ÿå‰§æœ¬åŸå‹ç²¾é€‰çš„æˆé•¿èµ„æº</p>
        </header>

        <!-- æœç´¢åŒºåŸŸ -->
        <section class="resources-search-section">
            <div id="search-container"></div>
        </section>

        <!-- ç­›é€‰åŒºåŸŸ -->
        <section class="resources-filter-section">
            <span class="filter-label">é€‰æ‹©åŸå‹ï¼š</span>
            <div id="archetype-selector-container"></div>
            
            <span class="filter-label">èµ„æºç±»å‹ï¼š</span>
            <div id="type-filter-container"></div>
        </section>

        <!-- ç»“æœåŒºåŸŸ -->
        <section class="resources-results-section">
            <div class="results-header">
                <h2 id="results-title">å…¨éƒ¨èµ„æº</h2>
                <span class="results-count">å…± <span id="results-count">0</span> ä¸ªèµ„æº</span>
            </div>
            <div id="resources-list-container"></div>
        </section>
    </div>

    <!-- è„šæœ¬ -->
    <script src="../js/resource-data.js"></script>
    <script src="../js/resource-ui.js"></script>
    <script>
        // é¡µé¢çŠ¶æ€
        let currentState = {
            archetype: 'all',
            type: 'all',
            searchQuery: ''
        };

        // åˆå§‹åŒ–é¡µé¢
        function init() {
            renderSearch();
            renderArchetypeSelector();
            renderTypeFilter();
            renderResources();
        }

        // æ¸²æŸ“æœç´¢æ¡†
        function renderSearch() {
            ResourceSearch.render('search-container', (query) => {
                currentState.searchQuery = query;
                renderResources();
            });
        }

        // æ¸²æŸ“åŸå‹é€‰æ‹©å™¨
        function renderArchetypeSelector() {
            ArchetypeSelector.render('archetype-selector-container', (archetypeId) => {
                currentState.archetype = archetypeId;
                renderResources();
            });
        }

        // æ¸²æŸ“ç±»å‹ç­›é€‰å™¨
        function renderTypeFilter() {
            TypeFilter.render('type-filter-container', (type) => {
                currentState.type = type;
                renderResources();
            });
        }

        // æ¸²æŸ“èµ„æºåˆ—è¡¨
        function renderResources() {
            const container = document.getElementById('resources-list-container');
            const titleEl = document.getElementById('results-title');
            const countEl = document.getElementById('results-count');

            let resources = [];
            let title = 'å…¨éƒ¨èµ„æº';

            // æœç´¢æ¨¡å¼
            if (currentState.searchQuery) {
                title = `æœç´¢ç»“æœï¼š"${currentState.searchQuery}"`;
                const searchResults = ResourceService.searchResources(currentState.searchQuery);
                searchResults.forEach(result => {
                    result.resources.forEach(r => {
                        resources.push({
                            ...r,
                            archetypeName: result.archetype.archetypeName,
                            archetypeIcon: result.archetype.archetypeIcon
                        });
                    });
                });
            } else {
                // ç­›é€‰æ¨¡å¼
                if (currentState.archetype === 'all') {
                    // è·å–æ‰€æœ‰åŸå‹èµ„æº
                    Object.values(ARCHETYPE_RESOURCES).forEach(archetypeData => {
                        archetypeData.resources.forEach(r => {
                            resources.push({
                                ...r,
                                archetypeName: archetypeData.archetypeName,
                                archetypeIcon: archetypeData.archetypeIcon
                            });
                        });
                    });
                    // æ·»åŠ é€šç”¨èµ„æº
                    GENERAL_RESOURCES.resources.forEach(r => {
                        resources.push({
                            ...r,
                            archetypeName: 'é€šç”¨èµ„æº',
                            archetypeIcon: 'ğŸ“š'
                        });
                    });
                } else {
                    const archetypeData = ARCHETYPE_RESOURCES[currentState.archetype];
                    if (archetypeData) {
                        title = `${archetypeData.archetypeIcon} ${archetypeData.archetypeName}ä¸“å±èµ„æº`;
                        resources = archetypeData.resources.map(r => ({
                            ...r,
                            archetypeName: archetypeData.archetypeName,
                            archetypeIcon: archetypeData.archetypeIcon
                        }));
                    }
                }
            }

            // æŒ‰ç±»å‹ç­›é€‰
            if (currentState.type !== 'all') {
                resources = resources.filter(r => r.type === currentState.type);
            }

            // æ›´æ–°æ ‡é¢˜å’Œè®¡æ•°
            titleEl.textContent = title;
            countEl.textContent = resources.length;

            // æ¸²æŸ“èµ„æºåˆ—è¡¨
            ResourceList.render('resources-list-container', resources, { showArchetype: currentState.archetype === 'all' });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
